{% extends 'adminpanel/base_admin.html' %}
{% block title %}Order #{{ order.id }} | AuroraMart Admin{% endblock %}

{% block content %}
<h2>Order #{{ order.id }}</h2>
<div class="card">
  <div class="card-body">
    <p><strong>Customer:</strong> {{ order.user.username }} ({{ order.user.email }})</p>
    <p><strong>Total:</strong> ${{ order.total_price }}</p>
    <p>
      <strong>Status:</strong>
      {# Only show the edit form for non-delivered orders. Delivered should be confirmed by customer. #}
      {% if order.status != 'Delivered' %}
        <form method="post" style="display:inline-block; margin-left:8px;">
          {% csrf_token %}
          <select name="status" class="form-select" style="display:inline-block; min-width:160px;">
            {% for val, label in status_choices %}
              <option value="{{ val }}" {% if order.status == val %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
          <button type="submit" class="btn btn-accent" style="margin-left:8px; margin-top:6px; display:inline-block; vertical-align:middle;">Update</button>
        </form>
      {% endif %}
      <!-- Show the precise status text (Processing / Shipped / Out for Delivery / Delivered) -->
      <span style="margin-left:12px;" class="status-badge {% if order.status == 'Delivered' %}completed{% else %}in-progress{% endif %}">{{ order.status }}</span>
    </p>
    {% if order.delivered_at %}
      <p><strong>Delivered at:</strong> {{ order.delivered_at|date:"M j, Y â€¢ H:i" }}</p>
    {% endif %}
    <h4 class="mt-3">Items</h4>
    <table class="table">
      <thead><tr><th>Product</th><th>Qty</th><th>Price</th></tr></thead>
      <tbody>
        {% for it in items %}
          <tr>
            <td>{{ it.product.name }}</td>
            <td>{{ it.quantity }}</td>
            <td>${{ it.price }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
