{% extends "storefront/base.html" %}
{% block title %}Your Cart â€” AuroraMart{% endblock %}
{% block content %}
<h2>Your Cart</h2>
{% if cart_items %}
  <div class="section">
    {% for item in cart_items %}
      <div class="card" style="text-align:left; display:flex; align-items:center; gap:12px;">
        {% if item.product.image %}
          <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" style="width:96px; height:96px; object-fit:cover; border-radius:8px;">
        {% endif %}
        <div style="flex:1">
          <strong>{{ item.product.name }}</strong><br>
          <small class="muted">In stock: {{ item.product.stock }}</small>
          <div style="display:flex; align-items:center; gap:8px; margin-top:8px;">
            <form method="post" action="{% url 'storefront:cart_update' item.product.id %}">
              {% csrf_token %}
              <input type="hidden" name="action" value="decrement">
              <button class="chip" type="submit">-</button>
            </form>
            <form method="post" action="{% url 'storefront:cart_update' item.product.id %}">
              {% csrf_token %}
              <input type="number" name="quantity" value="{{ item.quantity }}" min="1" max="{{ item.product.stock }}" class="quantity-input" style="width:64px; text-align:center; padding:6px; border-radius:6px; border:1px solid #e6eaf2;" onchange="this.form.submit()">
              <noscript><button class="chip" type="submit">Update</button></noscript>
            </form>
            <form method="post" action="{% url 'storefront:cart_update' item.product.id %}">
              {% csrf_token %}
              <input type="hidden" name="action" value="increment">
              <button class="chip" type="submit">+</button>
            </form>
            <div style="margin-left:auto; text-align:right">
              <div>Subtotal: ${{ item.subtotal }}</div>
              <form method="post" action="{% url 'storefront:cart_remove' item.product.id %}">
                {% csrf_token %}
                <button class="chip" type="submit">Remove</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
  <div class="section">
    <p><strong>Total: </strong>${{ total }}</p>
    <a class="chip primary" href="{% url 'storefront:checkout' %}">Proceed to Checkout</a>
  </div>
  {% if complete_the_set %}
  <div class="section">
    <h3>Complete the set</h3>
    <p class="muted">Customers often add these to the same basket.</p>
    <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px;">
      {% for rec in complete_the_set %}
      <a class="card" href="{% url 'storefront:product_detail' rec.id %}">
        {% if rec.image %}
          <img src="{{ rec.image.url }}" alt="{{ rec.name }}" style="width:100%; height:140px; object-fit:cover; border-radius:8px; margin-bottom:8px;">
        {% endif %}
        <strong>{{ rec.name }}</strong>
        <small class="text-muted">${{ rec.price }}</small>
      </a>
      {% endfor %}
    </div>
  </div>
  {% endif %}
{% else %}
  <p>Your cart is empty. <a href="{% url 'storefront:product_list' %}">Shop now</a>.</p>
{% endif %}
{% endblock %}